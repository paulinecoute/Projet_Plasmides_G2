{% extends "biolib/base.html" %}

{% block title %}Gérer l’équipe · {{ team.name }}{% endblock %}

{% block content %}
<div class="container-fluid px-lg-5 py-5" style="max-width:900px;">

  <!-- BOUTON RETOUR -->
  <div class="mb-3">
    <a href="{% url 'team_detail' team.id %}"
       class="btn btn-outline-secondary rounded-pill btn-sm">
      ← Retour
    </a>
  </div>

  <!-- HEADER -->
  <div class="mb-5">
    <h2 class="fw-bold mb-1">Gestion de l’équipe</h2>
    <div class="text-muted">{{ team.name }}</div>
  </div>

  <!-- INFO -->
  <div class="alert alert-primary rounded-4 mb-5">
    <strong>Vous êtes responsable de cette équipe.</strong>
    <div class="small opacity-75">
      Vous pouvez gérer les membres et nommer un nouveau responsable.
    </div>
  </div>

  <!-- AJOUT MEMBRE -->
  <div class="card border-0 shadow-sm rounded-4 mb-5">
    <div class="card-body p-4">

      <h5 class="fw-semibold mb-3">Ajouter un membre</h5>

      <form method="post" class="d-flex gap-3 align-items-end">
        {% csrf_token %}

        <div class="flex-grow-1">
          <label class="form-label small text-muted">
            Adresse email
          </label>
          <input type="email"
                 name="email"
                 class="form-control"
                 placeholder="utilisateur@exemple.com"
                 required>
        </div>

        <button class="btn btn-primary rounded-pill px-4">
          Ajouter
        </button>
      </form>

    </div>
  </div>

  <!-- LISTE MEMBRES -->
  <div class="card border-0 shadow-sm rounded-4">
    <div class="card-body p-4">

      <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="fw-semibold mb-0">Membres de l’équipe</h5>
        <span class="text-muted small">
          {{ team.members.count }} membre(s)
        </span>
      </div>

      <div class="list-group list-group-flush">

        {% for member in team.members.all reversed %}
        <div class="list-group-item px-0 py-3 d-flex justify-content-between align-items-center">

          <!-- EMAIL -->
          <div class="fw-medium">
            {{ member.email }}
          </div>

          <!-- ACTIONS / BADGES -->
          <div class="d-flex align-items-center gap-3">

            {% if member == team.leader %}
              <span class="text-warning fs-5">★</span>
            {% else %}
              <form method="post"
                    action="{% url 'team_change_leader' team.id member.id %}">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-primary rounded-pill">
                  Nommer chef
                </button>
              </form>

              <form method="post"
                    action="{% url 'team_remove_member' team.id member.id %}">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger rounded-pill">
                  Retirer
                </button>
              </form>
            {% endif %}

          </div>

        </div>
        {% endfor %}

      </div>

    </div>
  </div>

  <!-- ZONE DANGEREUSE -->
  <div class="mt-5 pt-4 border-top">

    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h6 class="fw-semibold text-danger mb-1">
          Zone dangereuse
        </h6>
        <div class="text-muted small">
          Cette action supprimera définitivement l’équipe.
        </div>
      </div>

      <a href="{% url 'team_delete' team.id %}"
         class="btn btn-danger rounded-pill">
        Supprimer l’équipe
      </a>
    </div>

  </div>

</div>
{% endblock %}
